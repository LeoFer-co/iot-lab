<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>{{ device.device_name|capitalize }} - Estación</title>

    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet" />

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        :root {
            --body-bg: #1C242C;
            --header-bg: #3A4C5E;
            --accent: #D07B2C;
            --card-bg: #2A333B;
            --card-border: #424F5B;
            --text-color: #F0F0F0;
            --text-secondary: #B0B0B0;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--body-bg);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
        }

        h1 {
            color: var(--accent);
            text-align: center;
            margin-bottom: 20px;
        }

        .chart-container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 1px 1px 4px rgba(0,0,0,0.2);
        }

        canvas {
            width: 100% !important;
            height: 400px !important;
        }

        a {
            color: #5FC3E4;
            text-decoration: none;
        }

        .center {
            text-align: center;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>{{ device.device_name|capitalize }} (Estación Meteorológica)</h1>

    <div class="chart-container">
        <canvas id="estacionChart"></canvas>
    </div>

    <div class="center">
        <a href="{{ url_for('home') }}">Volver</a>
    </div>

    <script>
    // Suponiendo que tu backend pasa arrays de timestamps, temps, hums, press
    const timestamps = {{ timestamps|safe }};
    const temps = {{ temps|safe }};
    const hums  = {{ hums|safe }};
    const press = {{ press|safe }};

    const ctx = document.getElementById('estacionChart').getContext('2d');
    const estacionChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: timestamps,
        datasets: [
          {
            label: 'Temperatura (°C)',
            data: temps,
            borderColor: '#FF5A5F',
            fill: false,
            tension: 0.1
          },
          {
            label: 'Humedad (%)',
            data: hums,
            borderColor: '#5FC3E4',
            fill: false,
            tension: 0.1
          },
          {
            label: 'Presión (hPa)',
            data: press,
            borderColor: '#FFC45F',
            fill: false,
            tension: 0.1
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          x: {
            ticks: {
              color: "#FFFFFF",
              callback: function(value, index, ticks) {
                let label = this.getLabelForValue(value);
                // Ejemplo: label = "YYYY-MM-DD HH:MM:SS" => extraer HH:MM
                return label.substring(11, 16);
              },
              maxTicksLimit: 6
            },
            title: {
              display: true,
              text: 'Hora',
              color: "#FFFFFF"
            }
          },
          y: {
            ticks: { color: "#FFFFFF" },
            title: {
              display: true,
              text: 'Valores',
              color: "#FFFFFF"
            }
          }
        },
        plugins: {
          legend: {
            labels: { color: "#FFFFFF" }
          }
        }
      }
    });
    </script>
</body>
</html>
